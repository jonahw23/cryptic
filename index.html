<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cryptic</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="chat-container">

        <div class="message-area">
            <div id="date-0" class="date"></div>
            <div id="typing-bubble-0" class="message typing-bubble-received hidden">
                <div class="dot"></div>
                <div class="dot"></div>
                <div class="dot"></div>
            </div>

            <div id="clue-mount-0" class="message received hidden"></div>

            <div id="typing-bubble-1" class="message typing-bubble-sent hidden">
                <div class="dot"></div>
                <div class="dot"></div>
                <div class="dot"></div>
            </div>
            
            <div id="clue-mount-1" class="message sent hidden"></div>

            <div id="date-1" class="date hidden"></div>

            <div id="typing-bubble-2" class="message typing-bubble-sent hidden">
                <div class="dot"></div>
                <div class="dot"></div>
                <div class="dot"></div>
            </div>

            <div id="clue-mount-2" class="message sent hidden"></div>

            <div id="typing-bubble-3" class="message typing-bubble-received hidden">
                <div class="dot"></div>
                <div class="dot"></div>
                <div class="dot"></div>
            </div>

            <div id="clue-mount-3" class="message received hidden"></div>

            <div id="date-2" class="date hidden"></div>

            <div id="typing-bubble-4" class="message typing-bubble-sent hidden">
                <div class="dot"></div>
                <div class="dot"></div>
                <div class="dot"></div>
            </div>

            <div id="clue-mount-4" class="message sent hidden"></div>

            <div id="typing-bubble-5" class="message typing-bubble-received hidden">
                <div class="dot"></div>
                <div class="dot"></div>
                <div class="dot"></div>
            </div>

            <div id="clue-mount-5" class="message received hidden"></div>

        </div>
    </div>
</body>

<script>

  const solved = []; // global to track which clues have been completed

  function createCrypticClue({ answer, clue, i }) {
    if(solved.length < i - 1){
        solved.push(false)
    } else{
        solved[i] = false;
    }
    const root = document.createElement("div");
    root.className = "cryptic-clue";

    // HTML for a single clue
    root.innerHTML = `
        <div class="center">
    <div class="prompt">
        ${clue}
    </div>
    
    <div class="answer-row"></div>

    <div class="buttonRow">
        <div class="mainButtonRow">
            <button class="hintBtn">
                Hint
            </button>
            
            <button class="checkBtn">
                Check
            </button>
        </div>
        <div class="hintButtonRow hidden" style="width: 100%; gap: 10px;">
            <button class="defBtn">
                Show Definition
            </button>

            <button class="fodderBtn">
                Show Fodder
            </button>
            
            <button class="indBtn">
                Show Indicators
            </button>
        </div>
    </div>

  </div>
    `;

    const row = root.querySelector(".answer-row");

    const answerChars = [...answer];

    console.log(answerChars)

    answerChars.forEach((ch, i) => {
        const input = document.createElement("input"); 
        input.className = "letter-box";
        input.maxLength = 1;
        input.autocomplete = "off";
        input.spellcheck = false;
        input.dataset.index = i;

        row.appendChild(input);
        
    });

    const boxes = Array.from(root.querySelectorAll(".letter-box"));

    boxes.forEach((box, idx) => {
      box.addEventListener("input", () => {
        box.value = box.value.slice(0, 1);
        if (box.value && idx < boxes.length - 1) {
          boxes[idx + 1].focus();
        }
        updateCheckEnabled();
      });

      box.addEventListener("keydown", (e) => {
        const key = e.key;

        if (key === "Backspace" && !box.value && idx > 0) {
          e.preventDefault();
          boxes[idx - 1].focus();
          boxes[idx - 1].value = "";
          updateCheckEnabled();
          return;
        }

        if (key === "ArrowLeft" && idx > 0) {
          e.preventDefault();
          boxes[idx - 1].focus();
        }

        if (key === "ArrowRight" && idx < boxes.length - 1) {
          e.preventDefault();
          boxes[idx + 1].focus();
        }

        updateCheckEnabled();
      });
    });

    // Focus first box on load
    if (boxes[0]) boxes[0].focus();

    const checkBtn = root.querySelector(".checkBtn");
    const hintBtn = root.querySelector(".hintBtn");
    const defBtn = root.querySelector(".defBtn");
    const fodderBtn = root.querySelector(".fodderBtn");
    const indBtn = root.querySelector(".indBtn");
    const numberHint = root.querySelector(".numHint");
    const hintBtnRow = root.querySelector(".hintButtonRow");
    const mnBtnRow = root.querySelector(".mainButtonRow");

    numberHint.innerText = "(" + answer.length + ")"

    hintBtn.addEventListener("click", () => {
        if (hintBtnRow.classList.contains("hidden")) {
            hintBtnRow.classList.remove("hidden");
        } else {
            hintBtnRow.classList.add("hidden");
        }
    })

    defBtn.addEventListener("click", () => {
        const defSpans = root.querySelectorAll(".def");
        defSpans.forEach(defSpan => {
            defSpan.style.textDecoration = "underline";
            defSpan.style.textDecorationColor = "#59cafa";
            defSpan.style.textDecorationThickness = "3px";
        })
        defBtn.disabled = true;
    })

    fodderBtn.addEventListener("click", () => {
        const fodderSpans = root.querySelectorAll(".fodder");
        fodderSpans.forEach(fodderSpan => {
            fodderSpan.style.textDecoration = "underline";
            fodderSpan.style.textDecorationColor = "#ffd016";
            fodderSpan.style.textDecorationThickness = "3px";
        })
        fodderBtn.disabled = true;
    })

    indBtn.addEventListener("click", () => {
        const indSpans = root.querySelectorAll(".ind");
        indSpans.forEach(indSpan => {
            indSpan.style.textDecoration = "underline";
            indSpan.style.textDecorationColor = "#fe6dbd";
            indSpan.style.textDecorationThickness = "3px";
        })
        indBtn.disabled = true;
    })

    checkBtn.addEventListener("click", () => {
    const guess = boxes.map(b => b.value).join("");
    const correct = guess.toLowerCase() === answer.toLowerCase();

    if (!correct) {
        // shake animation
        row.classList.remove("shake");
        void row.offsetWidth;
        row.classList.add("shake");

        setTimeout(() => {
        row.classList.remove("shake");
        }, 250);
    } else {
        const buttonRow = root.querySelector(".buttonRow");
        buttonRow.classList.add("hidden");
        hintBtnRow.classList.add("hidden");
        mnBtnRow.classList.add("hidden");

        boxes.forEach(element => {
            element.style.backgroundColor = "#f9a8d4";
            element.disabled = true;
        });

        solved[i] = true;
    }});

    function updateCheckEnabled() {
        const allFilled = boxes.every(b => b.value.trim().length === 1);
        checkBtn.disabled = !allFilled;
    }

    updateCheckEnabled();

    return root;
};

function waitForI(i) {
  return new Promise(resolve => {
    function checkFlag() {
      if (solved[i]) {
        resolve();
      } else {
        window.setTimeout(checkFlag, 500); 
      }
    }
    checkFlag();
  });
}

const clues = [
    {
        date: 0,
        character: 0,
        message: "Heyo!"
    },
    {
        character: 0,
        message: "It's me, the guy from Second Story haha"
    },
    {
        character: 0,
        message: "(The one you asked for puzzle booklet suggestions)"
    },
    {
        character: 0,
        message: `Here's the puzzle game I mentioned: <a href="https://www.minutecryptic.com/guide?back=%2F">Learn to<br> solve cryptic crosswords!</a>`,
    },
    {
        character: 0,
        message: "If you want to try it out, it's pretty fun to make<br> your own clues, they can send over text!"
    },
    {
        character: 0,
        message: "Unless you think it's too difficult :P"
    },
    {
        character: 0,
        answer: "word",
        clue: `<span class="def">Book store constituent</span> <span class="ind">unleashes</span> <span class="fodder">bolder texts</span> from <span class="fodder">bored world</span>! <span class="numHint" style="font-style: normal;"></span>`
    },
    {
        character: 1, 
        message: "light work"
    },
    {
        character: 1, 
        message: "if ur puzzling is REALLY up to snuff, we should <br>try to just talk in puzzles from here on out LMAO"
    },
    {
        character: 1,
        message: "unless its too difficult ;)"
    },
    {
        character: 1,
        answer: "crowd",
        clue: `<span class="fodder">Cipher</span> <span class="ind">starts cryptic</span> <span class="fodder">word</span> <span class="def">group</span>. <span class="numHint" style="font-style: normal;"></span>`,
    },
    {
        character: 0,
        answer: "ample",
        clue: `<span class="def">Generous</span> <span class="ind">cryptic</span> <span class="fodder">pal</span> <span class="ind">connected with</span> <span class="fodder">me</span>! <span class="numHint" style="font-style: normal;"></span>`,
    },
    {
        date: 1,
        character: 0,
        answer: "moral",
        clue: `<span class="def">Good</span> <span class="ind">early</span> <span class="fodder">morn'</span> <span class="fodder">all</span>! <span class="numHint" style="font-style: normal;"></span>`
    },
    {
        character: 1,
        answer: "hangman",
        clue: `<span class="fodder">Hang</span> <span class="ind">on, starting</span> <span class="fodder">manual</span> <span class="def">fill-in-the-blank game</span>. <span class="numHint" style="font-style: normal;"></span>`,
    },
    {  
        date: 2,
        character: 0,
        answer: "kinda",
        clue: `<span class="def">Sort of</span> <span class="ind">mixed up</span>, <span class="fodder">an</span> <span class="fodder">uncertainty in the text chat</span>? <span class="numHint" style="font-style: normal;"></span>`
    },
    {
        character: 1,
        answer: "money",
        clue: `<span class="ind">Short</span> <span class="fodder">first day of work</span>—<span class="ind">start and end</span> <span class="fodder">easily</span> <span class="def">holds the most value</span>. <span class="numHint" style="font-style: normal;"></span>`
    },
    {
        date: 3,
        character: 0,
        answer: "whimsy",
        clue: `<span class="fodder">“Who I am, say?</span>” <span class="ind">said with no voices except</span> <span class="fodder">your self’s</span> <span class="def">quirky imagination</span>. <span class="numHint" style="font-style: normal;"></span>`
    },
    {   
        character: 1,
        answer: "hiccup",
        clue: `<span class="def">Effervescent effect</span> <span class="ind">contained in</span> <span class="fodder">chic cups</span>. <span class="numHint" style="font-style: normal;"></span>`
    },
    {
        date: 4,
        character: 0,
        answer: "aliterate",
        clue: `<span class="ind">Alternating</span> <span class="fodder">daily hints tear partner</span> <span class="def">away from books</span>. <span class="numHint" style="font-style: normal;"></span>`
    },
    {
        character: 1,
        answer: "duo",
        time: 12000,
        clue: `<span class="fodder">Don’t</span> <span class="ind">get ahead of</span> <span class="fodder">yourself</span>... <span class="ind">Talking</span> <span class="ind">just started</span>, <span class="fodder">only</span> <span class="def">two pals</span>. <span class="numHint" style="font-style: normal;"></span>`
    },
    {
        character: 0, 
        answer: "oops",
        clue: `<span class="def">Mistaken</span> <span class="fodder">crossword</span> <span class="ind">tones</span>, <span class="fodder">pause</span> <span class="ind">after being toneless</span>. <span class="numHint" style="font-style: normal;"></span>`
    },
    {
        date: 5,
        character: 1,
        time: 14000,
        answer: "friends",
        clue: `<span class="def">Our filing status</span> <span class="fodder">transfixed</span>, <span class="fodder">tax</span> <span class="ind">deducted</span> <span class="ind">but still mixed up</span>. <span class="numHint" style="font-style: normal;"></span>`
    },
    {
        character: 0,
        answer: "cool",
        time: 2000,
        clue: `<span class="fodder">James Bond</span> <span class="ind">does a flip</span> <span class="ind">after saying</span> “<span class="fodder">see?</span>” <span class="def">Awesome</span>! <span class="numHint" style="font-style: normal;"></span>`
    },
    {
        date: 6,
        character: 0,
        answer: "waiter",
        clue: `<span class="def">Plate handler</span> <span class="ind">drops</span> <span class="fodder">one</span> <span class="ind">into</span> <span class="fodder">water</span>. <span class="numHint" style="font-style: normal;"></span>`
    },
    {
        date: 7,
        character: 1,
        answer: "torn",
        time: 5000,
        clue: `<span class="def">Not sure</span> what <span class="fodder">attorneys, detouring, tambourines, and extortion</span> <span class="ind">have in common?</span> <span class="numHint" style="font-style: normal;"></span>`
    },
    {
        date: 8,
        character: 0,
        answer: "toffee",
        clue: `<span class="def">Sticky, sweet</span> <span class="ind">amid</span> <span class="fodder">unrest of feelings</span>. <span class="numHint" style="font-style: normal;"></span>`
    },
    {
        date: 9,
        character: 1,
        answer: "at",
        clue:  `<span class="def">Shift two</span> <span class="ind">borders of an</span> <span class="fodder">accident</span>. <span class="numHint" style="font-style: normal;"></span>`
    },
    {
        date: 10,
        character: 1,
        answer: "sigh",
        clue: `“<span class="fodder">Sorry I guess,” he</span> <span class="ind">starts</span>, <span class="def">sounding like giving up</span>. <span class="numHint" style="font-style: normal;"></span>`
    },
    {
        character: 0,
        message: "You okay?",
        time: 12000
    },
    {
        character: 1,
        answer: "truants",
        clue: `<span class="ind">Waste-of</span>-<span class="fodder">space person</span> <span class="ind">dropped</span>, <span class="ind">shouts</span> “<span class="fodder">Oh! Ay!</span>” <span class="def">They don’t try to learn</span>? <span class="numHint" style="font-style: normal;"></span>`
    },
    {
        character: 0,
        answer: "persevere",
        clue: `<span class="ind">Begin</span> <span class="fodder">performing</span> <span class="fodder">very serious</span> <span class="def">when life gives you lemons?</span> <span class="numHint" style="font-style: normal;"></span>`
    },
    {
        date: 11,
        character: 1,
        answer: "zero",
        clue: `<span class="def">What’s left after</span> <span class="fodder">I</span> <span class="ind">lose</span> the <span class="fodder">one</span>... <span class="numHint" style="font-style: normal;"></span>`
    },
    { 
        character: 0,
        answer: "felt",
        clue: `<span class="ind">Even</span> <span class="fodder">after a glut</span> <span class="def">of softness crushed flat, this remains</span>. <span class="numHint" style="font-style: normal;"></span>`
    },
    {
        date: 12,
        character: 1,
        answer: "ices",
        clue: `<span class="ind">Break-up</span> <span class="fodder">is</span> <span class="ind">framing</span> <span class="fodder">this time in history</span> <span class="def">as becoming cold and hard?</span> <span class="numHint" style="font-style: normal;"></span>`
    },
    {
        character: 0,
        answer: "bayou",
        clue: `“<span class="fodder">Bye,” you</span> <span class="ind">said</span>—<span class="def">a blossom of life surrounded by muck</span>. <span class="numHint" style="font-style: normal;"></span>`
    },
    {
        date: 13,
        character: 1,
        answer: "noshing",
        clue: `<span class="ind">In retrospect</span>, <span class="fodder">better off</span> <span class="ind">skipping</span> <span class="fodder">out</span> <span class="ind">on</span> <span class="fodder">shouting</span> <span class="def">fat-ass engagement</span>. <span class="numHint" style="font-style: normal;"></span>`
    },
    {
        character: 0,
        message: "Diabolically hard clue haha",
        time: 10000
    },
    {
        character: 0,
        message: "But great surface ngl",
        time: 1000,
    },
    {
        character: 1,
        message: ":)",
    },
    {
        character: 0,
        answer: "affirm",
        clue: `<span class="def">Encouragement offered</span> <span class="ind">after</span> <span class="ind">ignor- ing the boundaries of</span> <span class="fodder">firm’s gaffe</span> <span class="ind">is reflected on</span>. <span class="numHint" style="font-style: normal;"></span>`
    },
    {
        date: 14,
        character: 1,
        answer: "extol",
        clue: `<span class="def">Speaking highly of</span> <span class="fodder">past partner</span> <span class="ind">barely</span> <span class="fodder">tolerable</span>? <span class="numHint" style="font-style: normal;"></span>`
    },
    {
        character: 0,
        answer: "ego",
        clue: `<span class="fodder">Therefore</span>, <span class="ind">without saying</span> <span class="fodder">our</span> <span class="def">over-inflated feelings</span>? <span class="numHint" style="font-style: normal;"></span>`
    },
    {
        date: 15,
        character: 1,
        answer: "lonely",
        clue: `<span class="ind">In between</span> <span class="fodder">two losses</span>, <span class="fodder">I</span> <span class="ind">ask<span> <span class="fodder">why</span> <span class="def">I feel this way</span>. <span class="numHint" style="font-style: normal;"></span>`
    },
    {
        character: 0,
        answer: "hug",
        time: 6000,
        clue: `<span class="fodder">Ugh!</span> <span class="ind">Scrambling</span> <span class="def">to hold someone</span>. <span class="numHint" style="font-style: normal;"></span>`
    },
    {
        character: 1,
        answer: "overplanting",
        clue: `<span class="fodder">Solving partner</span> <span class="ind">freed from confines</span>, <span class="ind">parties</span> <span class="def">beyond what the ground can handle</span>.<span class="numHint" style="font-style: normal;"></span>`
    },
    {
        date: 16,
        character: 0,
        answer: "dart",
        clue: `<span class="def">Moving past quickly</span> from <span class="fodder">faltered</span> <span class="ind">confusion</span>, <span class="fodder">feel</span> <span class="ind">relieved</span>. <span class="numHint" style="font-style: normal;"></span>`
    },
    {
        character: 1,
        answer: "clicked",
        clue: `<span class="fodder">Bkbjdc</span>… <span class="ind">excellent puzzler</span> <span class="ind">and</span> <span class="fodder">I</span> <span class="def">quickly on good terms</span>. <span class="numHint" style="font-style: normal;"></span>`
    },
    {
        date: 17,
        character: 0,
        message: "Sheesh"
    },
    {
        character: 0,
        message: "You're cooking on these lately"
    },
    {
        character: 0,
        message: "I've gotta step up my game"
    },
    {
        character: 1,
        time: 5000,
        message: "stepping up by texting rather than puzzles tho??"
    },
    {
        character: 1,
        time: 1000,
        message: "or are u puzzled out :P"
    },
    {
        character: 0,
        message: "Oops haha"
    },
    {
        character: 0,
        message: "Meant to say:"
    },
    {
        character: 0,
        answer: "ponder",
        clue: `<span class="def">Puzzle technique</span> <span class="ind">part</span>-<span class="fodder">answered? Nope</span>, <span class="ind">all backwards</span>! <span class="numHint" style="font-style: normal;"></span>`
    },
    {
        character: 1,
        answer: "cutie",
        clue: `<span class="def">Endearing</span> <span class="fodder">crypticeer understands the intent, eagerly</span> <span class="ind">taking initiative</span>. <span class="numHint" style="font-style: normal;"></span>`
    },
    {
        date: 18,
        character: 0,
        answer: "stops",
        clue: `<span class="ind">Scattered</span> <span class="fodder">toilet paper</span> <span class="ind">delivered to</span> <span class="fodder">naval distress beacon</span> <span class="def">brings it to a halt</span>?? <span class="numHint" style="font-style: normal;"></span>`
    },
    {
        character: 1,
        message: "lollll",
        time: 3000,
    },
    {
        character: 1,
        message: "funny asf surface"
    },
    {
        character: 1,
        message: "a bit off topic thooo"
    },
    {
        character: 0,
        message: "Wdym?",
        time: 7000,
    },
    {
        character: 1,
        answer: "saute",
        time: 8000,
        clue: `<span class="def">Quick-cooking</span> <span class="ind">cryptic</span> <span class="fodder">enthusiast</span> <span class="ind">missing</span> <span class="fodder">hints</span>. <span class="numHint" style="font-style: normal;"></span>`
    },
    {
        character: 0,
        answer: "voila",
        time: 9000,
        clue: `<span class="ind">Reading into</span> <span class="fodder">convo? I lament</span> <span class="def">my expression of astonishment</span>. <span class="numHint" style="font-style: normal;"></span>`
    },
    {
        time: 10000,
        character: 1,
        message: "for smart people i guess we can be pretty dumb"
    },
    {
        character: 1,
        message: "to put it clearly:"
    },
    {
        character: 1,
        answer: "yes",
        clue: `<span class="fodder">Easy</span>, <span class="ind">shoot out</span> <span class="fodder">a</span> <span class="ind">question</span>: <span class="def">Want to go on a date?</span> <span class="numHint" style="font-style: normal;"></span>`
    },
    {
       character: 0,
       message: " I like that definition quite a bit", 
    },
    {
       character: 0,
       message: "I heard Second Story does trivia nights on Saturdays", 
    },
    {
        character: 0,
        message: "Dinner, then we head over and show them how it’s done?"
    },
    {
        character: 1,
        answer: "prom",
        clue: `<span class="ind">Get on</span>-<span class="fodder">route</span> <span class="ind">in</span> <span class="fodder">the evening</span>, <span class="def">big date event?!</span> <span class="numHint" style="font-style: normal;"></span>`
    },
    {
        character: 0,
        answer: "sat",
        clue: `<span class="ind">Sounds like</span> <span class="fodder">the start of a plan, it</span>’s <span class="def">a date then</span>. <span class="numHint" style="font-style: normal;"></span>`
    },
    {
        character: 1,
        answer: "enigma",
        clue: `<span class="fodder">Exciting new</span> <span class="ind">beginnings all around!</span> <span class="fodder">I gave my all</span> to <span class="def">a perplexing puzzle</span>. <span class="numHint" style="font-style: normal;"></span>`
    }
]


function createBubble({ sent }){
    const root = document.createElement("div");
    const sentBubbleHTML = `
    <div class="message typing-bubble-${sent === 0 ? "sent" : "received"}">
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
    </div>
    `
    root.innerHTML = sentBubbleHTML;
    return root;
}

function createDate( {date_mod} ){
    const root = document.createElement("div");
    root.classList.add("date");

    const dateO = new Date();
    dateO.setDate(dateO.getDate() + date_mod)
    const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
    const localeDateString = dateO.toLocaleDateString('en-US', options);
    root.innerHTML = localeDateString;

    return root;
}

function createClueMessage({ sent }){
    const root = document.createElement("div");

    root.classList.add("message");
    root.classList.add(sent === 0 ? "sent" : "received");

    return root;
}

function createWordMessage({ sent, message }){
    const root = document.createElement("div");

    root.classList.add("message");
    root.classList.add(sent === 0 ? "sent" : "received");
    root.innerHTML = message;

    return root;
}


const scrollable = document.querySelector(".message-area")
async function run(){
    let z = 0;
    while(z < clues.length){

        if(clues[z].date != null){
            scrollable.appendChild(createDate({date_mod: clues[z].date}))
        }
        scrollable.appendChild(createBubble({sent: clues[z].character}))
        scrollable.scrollTop = scrollable.scrollHeight;
        let timeToBubble = clues[z].time != null ? clues[z].time : 2000
        setTimeout(() => {
        scrollable.removeChild(scrollable.lastElementChild)
        if(clues[z].message != null){
            scrollable.appendChild(createWordMessage({sent: clues[z].character, message: clues[z].message}))
            solved.push(true);
        } else{
            scrollable.appendChild(createClueMessage({sent: clues[z].character}))
            scrollable.lastElementChild.appendChild(createCrypticClue({
                answer: clues[z].answer,
                clue: clues[z].clue,
                i: z
            }));
        }
        scrollable.scrollTop = scrollable.scrollHeight;
        }, timeToBubble);

        await waitForI(z);
        z++;
    }
}

run();

</script>

</html>